# LC APP - 商业文档管理系统

一个用于处理报价单、销售确认单和发票等商业文档的生成和管理系统。

## 功能特性

### 1. 报价单和订单确认书生成
- 支持报价单和订单确认书的快速生成
- 可自定义客户信息、商品明细、备注等内容
- 支持多币种（USD/CNY）
- 提供专业的 PDF 导出功能
- 支持本地历史记录保存和管理
- 移动端输入体验优化：光标可见、智能滚动、触摸友好

### 2. 采购订单管理
- 生成给供应商的采购订单
- 支持供应商信息管理
- 可自定义采购商品明细
- 提供专业的 PDF 导出功能
- 支持采购历史记录管理
- 支持编辑现有采购订单
- 支持复制采购订单创建新订单
- 移动端友好：触摸优化、键盘适配

### 3. 装箱单和形式发票
- 支持三种文档类型：形式发票、装箱单、两者合并
- 智能文档类型切换，自动调整显示选项
- 支持收货人信息管理
- 可配置显示项目：HS编码、尺寸、重量包装、价格等
- 支持唛头信息设置
- 多种单位支持，智能单复数转换
- 支持多币种显示
- 可选的固定备注条款
- 完整的历史记录管理功能
- 支持编辑和复制历史记录
- 集成到统一的单据管理中心
- 移动端表格输入优化：清晰光标、智能滚动

### 4. AI 邮件助手
- 智能生成商务邮件
- 支持中英文双语邮件
- 多种邮件语气风格可选
- 快速邮件回复建议
- 移动端输入优化：防误触、流畅编辑

### 5. 用户管理
- 多用户支持
- 基于角色的权限控制
- 管理员后台管理

### 6. 系统特性
- 支持深色/浅色主题
- 响应式设计，支持移动端访问
- 本地数据存储，保护隐私
- 全面的移动端优化，提供桌面级输入体验

## 技术栈

- **前端框架**: Next.js 14
- **UI 框架**: TailwindCSS
- **状态管理**: React Hooks
- **认证**: NextAuth.js
- **数据库**: Prisma + PostgreSQL
- **AI 集成**: DeepSeek API
- **PDF 生成**: jsPDF
- **移动端优化**: iOS WebKit适配、触摸优化、键盘处理、CSS硬件加速、PWA支持

## 开发环境设置

1. 克隆项目
```bash
git clone [repository-url]
cd mluonet
```

2. 安装依赖
```bash
npm install
```

3. 环境变量配置
创建 `.env.local` 文件并添加以下配置：
```env
DEEPSEEK_API_KEY=your_api_key
DATABASE_URL=your_database_url
NEXTAUTH_SECRET=your_nextauth_secret
```

4. 启动开发服务器
```bash
npm run dev
```

## 部署

1. 构建项目
```bash
npm run build
```

2. 启动生产服务器
```bash
npm start
```

## 数据存储说明

- 用户数据存储在 PostgreSQL 数据库中
- 报价历史记录使用浏览器的 localStorage 存储
- 采购订单历史记录使用浏览器的 localStorage 存储
- 发票历史记录使用浏览器的 localStorage 存储
- 装箱单历史记录使用浏览器的 localStorage 存储
- AI 生成的内容不会被永久存储

## 注意事项

1. localStorage 存储限制
   - 浏览器的 localStorage 通常限制在 5-10MB
   - 建议定期导出重要的报价历史记录
   - 清除浏览器数据会导致历史记录丢失

2. AI 功能使用
   - 需要配置有效的 DeepSeek API Key
   - API 调用有频率限制
   - 生成的内容建议人工审核

3. 移动端使用建议
   - **iOS设备**: 已进行全面优化，包括光标可见性、键盘滚动、触摸响应等
   - **推荐浏览器**: Safari浏览器（iOS）、Chrome浏览器（Android）
   - **PWA安装**: 支持添加到主屏幕，提供类原生应用体验
   - **输入体验**: 
     - 自动防止意外缩放，字体大小智能适配
     - 键盘弹起时输入框自动滚动到可视区域
     - 表格输入支持键盘导航（方向键、Tab键）
   - **触摸优化**: 针对移动端触摸操作进行专门优化，响应迅速精准

## 更新日志

### V1.3.1 - 移动端输入体验全面优化
- **iOS光标可见性问题修复**: 系统性解决了iOS设备上输入框光标"隐藏在图层下方"的问题
- **统一优化策略**: 开发了统一的`ios-optimized-input`CSS类，应用于所有输入框组件
- **全页面覆盖**: 优化覆盖所有页面的输入框，包括：
  - 报价单页面的非表格输入框（客户信息、询价号、合同号等）
  - 报价单页面的表格内输入框（商品名称、描述、数量、单价等）
  - 发票页面的非表格输入框（客户信息、发票号等）
  - 发票页面的表格内输入框（商品信息、单价等）
  - 采购单和装箱单页面的所有输入框
- **移动端文字大小优化**: 
  - 防止iOS设备自动放大：设置最小字体大小为16px
  - 避免意外缩放：使用`transform: scale(1)`锁定缩放比例
  - 智能字体大小：采用`max(16px, 1em)`确保可读性
- **键盘弹起滚动优化**:
  - 智能滚动定位：输入框获得焦点时自动滚动到视口中心
  - 延迟处理机制：300ms延迟确保键盘完全展开后再滚动
  - 平滑滚动体验：使用`scrollIntoView`提供流畅的滚动动画
- **触摸体验优化**:
  - 触摸动作优化：`touch-action: manipulation`提升触摸响应
  - 长按菜单控制：禁用不必要的长按菜单，避免误操作
  - 文本选择优化：精确控制文本选择行为
- **视口和PWA优化**:
  - 专业视口设置：`width=device-width, initial-scale=1, maximum-scale=1`
  - PWA支持：`mobile-web-app-capable`和`apple-mobile-web-app-capable`
  - 状态栏适配：`apple-mobile-web-app-status-bar-style`优化
- **表格输入框移动端适配**:
  - 最小高度保证：表格输入框在移动设备上最小高度32px
  - 行高优化：`line-height: 1.2`确保文字可读性
  - 硬件加速：`translateZ(0)`优化表格输入框性能
- **技术实现优化**:
  - 简化复杂的内联样式，避免WebKit属性冲突
  - 增强全局CSS规则，添加硬件加速和特殊修复
  - 为表格输入框添加`translateZ(0)`硬件加速优化
  - 支持暗色模式下的光标颜色自动适配
  - 使用`@supports`查询进行渐进式增强
- **用户体验提升**: 移动端用户现在享有桌面级的输入体验，包括清晰的光标、流畅的滚动和精准的触摸响应
- **兼容性保证**: 所有优化都采用渐进式增强策略，不影响其他平台的正常使用

### V1.3.0 - 装箱单功能完整实现
- **装箱单页面功能**: 完整实现装箱单和形式发票生成功能，支持三种文档类型（形式发票、装箱单、两者合并）
- **智能配置系统**: 根据文档类型自动调整显示选项，提升用户体验
- **收货人信息管理**: 支持详细的收货人信息录入和管理
- **灵活显示选项**: 可配置显示HS编码、尺寸、重量包装、价格等各项信息
- **唛头信息支持**: 专门的唛头编辑模态框，支持复杂唛头信息设置
- **智能单位系统**: 支持多种单位，自动处理单复数形式转换
- **完整历史记录**: 创建装箱单历史记录管理工具函数，支持保存、查询、编辑、删除等操作
- **历史页面集成**: 在单据管理中心添加装箱单tab，提供完整的历史记录管理界面
- **编辑复制功能**: 实现装箱单的编辑和复制功能，支持从历史记录快速创建新单据
- **PDF预览支持**: 在历史记录中支持装箱单PDF预览功能
- **统一用户体验**: 装箱单功能与其他单据类型保持一致的操作体验和界面风格
- **数据类型定义**: 完整的TypeScript类型定义，确保代码的健壮性和维护性

### V1.2.1 - 搜索结果显示优化
- **智能搜索徽章**: 在搜索框中输入字符后，每个tab图标上会显示红色徽章，实时显示该类型下的搜索结果数量
- **过滤条件响应**: 不仅搜索条件，所有过滤条件（日期范围、金额范围等）都会触发红色徽章显示
- **实时更新**: 徽章数量会随着搜索和过滤条件的变化实时更新
- **视觉区分**: 有过滤条件时显示红色徽章，无过滤条件时显示对应tab的默认颜色徽章

### V1.2.0 - 历史管理功能完善
- **统一历史页面布局**: 所有历史页面（报价单、订单确认书、发票、采购单）现在采用统一的现代化布局
- **增强排序功能**: 为所有历史页面添加了表头排序功能，支持按客户名称、单号、金额、创建时间等字段排序
- **完善操作功能**: 每个历史记录都支持预览、编辑、复制、删除等完整操作
- **批量操作支持**: 支持批量选择和批量删除操作
- **高级过滤功能**: 添加了日期范围过滤和金额范围过滤功能
- **智能搜索**: 支持按客户名称、单号、合同号等多字段搜索
- **金额统计**: 每个历史页面底部显示按币种分类的金额统计
- **响应式设计**: 优化了移动端显示效果，隐藏部分列以适配小屏幕
- **视觉优化**: 为不同类型的历史记录使用不同的主题色彩（蓝色-报价单、绿色-确认书、紫色-发票、橙色-采购单）
- **布局优化**: 将搜索和过滤功能移至顶部header区域，提升用户体验
- **Tab计数显示**: 在每个tab标题上显示搜索结果数量，方便用户了解各类型记录的数量

### V1.1.1
- 移除 Cloudflare D1 集成
- 改用 localStorage 存储报价历史
- 优化用户界面响应速度
- 修复已知问题

## 贡献指南

欢迎提交 Issue 和 Pull Request 来帮助改进项目。

## 许可证

[MIT License](LICENSE)
