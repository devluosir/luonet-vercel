# MLUONET - 企业级单据管理系统

## 项目概述

MLUONET是一个现代化的企业级单据管理系统，提供完整的报价单、采购单、发票、装箱单等业务单据的生成、管理和历史记录功能。

## 主要功能

### 1. 单据管理中心 (History Management)
- **权限控制**: 根据用户在tools页面的权限设置，动态显示可访问的选项卡
- **多类型支持**: 支持报价单、合同确认、采购单、装箱单、发票等历史记录管理
- **高级过滤**: 支持按时间、金额、类型等多维度过滤
- **批量操作**: 支持批量删除、导出、导入功能
- **实时搜索**: 支持客户名称、单据编号等快速搜索

#### 权限控制机制
- 系统会根据用户在tools页面的权限设置，自动显示/隐藏对应的选项卡
- 权限映射关系：
  - `quotation` 权限 → 显示"报价单"和"合同确认"选项卡
  - `invoice` 权限 → 显示"发票"选项卡
  - `purchase` 权限 → 显示"采购单"选项卡
  - `packing` 权限 → 显示"装箱单"选项卡

#### 功能特性
- **智能切换**: 如果当前选项卡没有权限，会自动切换到第一个有权限的选项卡
- **权限验证**: 所有操作（编辑、删除、预览、复制等）都会验证用户权限
- **无权限提示**: 当用户没有任何权限时，显示友好的提示信息
- **加载状态**: 在获取用户权限时显示加载动画

### 2. 工具页面 (Tools)
- **模块化设计**: 每个功能模块独立，支持权限控制
- **动态加载**: 根据用户权限动态显示可用工具
- **性能优化**: 使用缓存机制提升加载速度

### 3. 单据生成功能
- **报价单**: 支持报价单和销售确认单的生成
- **采购单**: 完整的采购订单管理
- **发票**: 专业的发票生成和管理
- **装箱单**: 详细的装箱单和发票生成

## 技术架构

### 前端技术栈
- **Next.js 14**: 使用App Router架构
- **React 18**: 最新的React特性
- **TypeScript**: 完整的类型安全
- **Tailwind CSS**: 现代化的样式系统
- **Lucide React**: 图标库

### 后端技术栈
- **Next.js API Routes**: 服务端API
- **Prisma**: 数据库ORM
- **NextAuth.js**: 身份认证
- **PostgreSQL**: 数据库

### 性能优化
- **动态导入**: 使用dynamic import减少初始包大小
- **缓存机制**: 用户信息和权限缓存
- **懒加载**: 组件和资源的懒加载
- **性能监控**: 内置性能监控和优化

## 权限系统

### 权限模型
```typescript
interface Permission {
  id: string;
  moduleId: string;
  canAccess: boolean;
}

interface User {
  id: string;
  username: string;
  email: string | null;
  status: boolean;
  isAdmin: boolean;
  permissions: Permission[];
}
```

### 权限控制流程
1. **用户登录**: 获取用户信息和权限
2. **权限验证**: 在每个功能模块验证用户权限
3. **动态显示**: 根据权限动态显示/隐藏功能
4. **操作验证**: 所有操作前都进行权限验证

## 开发指南

### 环境设置
```bash
# 安装依赖
npm install

# 设置环境变量
cp .env.example .env.local

# 运行开发服务器
npm run dev
```

### 数据库设置
```bash
# 运行数据库迁移
npx prisma migrate dev

# 生成Prisma客户端
npx prisma generate
```

### 权限管理
- 通过管理员界面为用户分配权限
- 权限变更会实时反映在界面上
- 支持细粒度的模块权限控制

## 部署

### 生产环境
- 使用Vercel进行部署
- 配置环境变量
- 设置数据库连接

### 性能优化
- 启用CDN加速
- 配置缓存策略
- 监控应用性能

## 更新日志

### v1.0.0
- 实现基础的单据管理功能
- 添加权限控制系统
- 优化用户界面和用户体验
- 完善错误处理和日志记录

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目。

## 许可证

MIT License
