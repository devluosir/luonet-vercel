# LC APP - 商业文档管理系统

一个用于处理报价单、销售确认单和发票等商业文档的生成和管理系统。

## 项目现状总览

### 📊 完成度：87%
- ✅ **核心功能完成**：报价单、发票、采购单、装箱单生成和管理
- ✅ **移动端优化完成**：iOS光标可见性、触摸体验、响应式设计、安卓PDF预览优化
- ✅ **用户管理系统完成**：多用户支持、权限控制、管理员后台
- ✅ **历史记录管理完成**：统一的单据管理中心，支持搜索、过滤、排序
- ✅ **设备兼容性完成**：全面的iOS/安卓/桌面端适配和优化
- 🚧 **AI功能部分完成**：邮件助手已实现，其他AI功能待开发
- 🚧 **高级功能开发中**：客户管理、库存管理、数据分析等

### 🎯 当前可用模块状态

| 模块 | 状态 | 功能完整度 | 说明 |
|------|------|-----------|------|
| 📄 **报价及确认** | ✅ 生产就绪 | 100% | 完整的报价单和订单确认书生成，支持PDF导出、历史记录管理 |
| 🧾 **发票助手** | ✅ 生产就绪 | 100% | 专业发票生成，支持多币种、自定义字段、历史管理 |
| 🛒 **采购订单** | ✅ 生产就绪 | 100% | 供应商采购单生成，银行信息管理，完整历史记录 |
| 📦 **装箱单** | ✅ 生产就绪 | 100% | 三合一文档（形式发票/装箱单/合并），唛头管理，智能配置 |
| 📋 **单据管理中心** | ✅ 生产就绪 | 100% | 统一的历史记录管理，支持搜索、过滤、批量操作、PDF预览 |
| ✉️ **AI邮件助手** | ✅ 基础可用 | 80% | 智能邮件生成，需要DeepSeek API配置 |
| 📅 **日期计算** | ✅ 基础可用 | 70% | 日期和天数计算工具 |
| 👥 **用户管理** | ✅ 生产就绪 | 95% | 多用户、权限控制、管理员后台 |
| 👤 **客户管理** | 🚧 开发中 | 10% | 占位页面，功能待实现 |
| 📊 **库存管理** | 🚧 开发中 | 10% | 占位页面，功能待实现 |
| 📈 **数据分析** | 🚧 开发中 | 10% | 占位页面，功能待实现 |

## 功能特性

### 1. 报价单和订单确认书生成 ✅
- 支持报价单和订单确认书的快速生成
- 可自定义客户信息、商品明细、备注等内容
- 支持多币种（USD/CNY）和自定义币种
- 提供专业的 PDF 导出功能
- 支持本地历史记录保存和管理
- 移动端输入体验优化：光标可见、智能滚动、触摸友好
- 支持编辑和复制历史记录

### 2. 采购订单管理 ✅
- 生成给供应商的采购订单
- 支持供应商信息管理
- 可自定义采购商品明细
- 银行信息管理（支持多个银行账户）
- 提供专业的 PDF 导出功能
- 支持采购历史记录管理
- 支持编辑现有采购订单
- 支持复制采购订单创建新订单
- 移动端友好：触摸优化、键盘适配

### 3. 装箱单和形式发票 ✅
- 支持三种文档类型：形式发票、装箱单、两者合并
- 智能文档类型切换，自动调整显示选项
- 支持收货人信息管理
- 可配置显示项目：HS编码、尺寸、重量包装、价格等
- 支持唛头信息设置
- 多种单位支持，智能单复数转换
- 支持多币种显示
- 可选的固定备注条款
- 完整的历史记录管理功能
- 支持编辑和复制历史记录
- 集成到统一的单据管理中心
- 移动端表格输入优化：清晰光标、智能滚动

### 4. 单据管理中心 ✅
- 统一管理所有类型的商业文档历史记录
- 智能搜索：支持客户名称、单号、合同号等多字段搜索
- 高级过滤：日期范围、金额范围过滤
- 表头排序：按客户名称、单号、金额、时间等排序
- 批量操作：批量选择和批量删除
- PDF预览：支持所有文档类型的在线预览
- 导入导出：支持历史记录的备份和恢复
- 响应式设计：优化移动端显示
- 深色模式：完整支持深色/浅色主题切换

### 5. AI 邮件助手 🚧
- 智能生成商务邮件
- 支持中英文双语邮件
- 多种邮件语气风格可选
- 快速邮件回复建议
- 移动端输入优化：防误触、流畅编辑
- **注意**：需要配置DeepSeek API密钥

### 6. 用户管理系统 ✅
- 多用户支持，基于NextAuth.js
- 细粒度权限控制（模块级权限）
- 管理员后台管理界面
- 用户状态管理（启用/禁用）
- 密码重置功能
- 个人资料管理

### 7. 系统特性 ✅
- 支持深色/浅色主题自动切换
- 响应式设计，完美支持移动端访问
- 本地数据存储，保护隐私
- 全面的移动端优化，提供桌面级输入体验
- PWA支持，可添加到手机主屏幕
- 跨浏览器兼容性

## 技术栈

- **前端框架**: Next.js 14 (App Router)
- **UI 框架**: TailwindCSS 3.4
- **类型系统**: TypeScript 5.7
- **状态管理**: React Hooks
- **认证**: NextAuth.js 4.24
- **数据库**: Prisma 6.1 + PostgreSQL
- **AI 集成**: DeepSeek API / OpenAI 4.77
- **PDF 生成**: jsPDF 2.5 + jsPDF-AutoTable
- **图标系统**: Lucide React 0.469
- **主题管理**: next-themes 0.4
- **日期处理**: date-fns 4.1
- **移动端优化**: iOS WebKit适配、触摸优化、键盘处理、CSS硬件加速、PWA支持

## 开发环境设置

### 前置要求
- Node.js 18+ 
- PostgreSQL 数据库
- Git

### 安装步骤

1. **克隆项目**
```bash
git clone [repository-url]
cd mluonet
```

2. **安装依赖**
```bash
npm install
```

3. **环境变量配置**
创建 `.env.local` 文件并添加以下配置：
```env
# 数据库连接
DATABASE_URL="postgresql://username:password@localhost:5432/mluonet"

# NextAuth配置
NEXTAUTH_SECRET="your-nextauth-secret"
NEXTAUTH_URL="http://localhost:3000"

# AI功能配置（可选）
DEEPSEEK_API_KEY="your-deepseek-api-key"

# 邮件配置（可选）
EMAIL_SERVER_HOST="smtp.example.com"
EMAIL_SERVER_PORT=587
EMAIL_SERVER_USER="your-email@example.com"
EMAIL_SERVER_PASSWORD="your-email-password"
EMAIL_FROM="noreply@example.com"
```

4. **数据库设置**
```bash
# 生成Prisma客户端
npx prisma generate

# 运行数据库迁移
npx prisma db push

# （可选）查看数据库
npx prisma studio
```

5. **启动开发服务器**
```bash
npm run dev
```

访问 `http://localhost:3000` 查看应用。

## 部署

### 生产环境构建

1. **构建项目**
```bash
npm run build
```

2. **启动生产服务器**
```bash
npm start
```

### Vercel部署（推荐）

1. 将项目推送到GitHub
2. 在Vercel中导入项目
3. 配置环境变量
4. 自动部署完成

### Docker部署（可选）

```dockerfile
# Dockerfile示例
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

## 数据存储架构

### 数据库存储（PostgreSQL）
- **用户数据**: users表，包含用户信息、权限设置
- **权限数据**: permissions表，模块级权限控制

### 本地存储（localStorage）
- **报价历史**: `quotationHistory` - 报价单和确认书记录
- **发票历史**: `invoiceHistory` - 发票记录
- **采购历史**: `purchaseHistory` - 采购订单记录
- **装箱单历史**: `packingHistory` - 装箱单记录
- **用户偏好**: 主题设置、界面偏好等

### 数据备份建议
- **定期导出**: 使用单据管理中心的导出功能备份重要数据
- **浏览器同步**: 建议使用Chrome/Safari的书签和数据同步功能
- **数据库备份**: 生产环境建议定期备份PostgreSQL数据库

## 使用指南

### 基础使用流程

1. **用户注册登录**
   - 首次访问需要注册账户
   - 管理员可以在后台为用户分配权限

2. **创建商业文档**
   - 选择对应的文档类型（报价单/发票/采购单/装箱单）
   - 填写客户/供应商信息
   - 添加商品明细
   - 预览和生成PDF

3. **历史记录管理**
   - 在单据管理中心查看所有历史记录
   - 使用搜索和过滤功能快速定位
   - 支持编辑、复制、删除操作

### 移动端使用建议

- **iOS设备**: 已进行全面优化，推荐使用Safari浏览器
  - 光标可见性问题已完全解决
  - 支持PWA安装获得原生应用体验
  - 键盘弹起自动滚动优化
- **Android设备**: 已针对PDF预览进行专门优化
  - **Chrome浏览器（推荐）**: 支持新窗口PDF预览
  - **其他浏览器**: 提供直接下载查看方式
  - 智能检测浏览器类型并提供最佳操作建议
  - 显示设备和浏览器信息，提供个性化指导
- **PWA安装**: 在浏览器中选择"添加到主屏幕"
- **输入优化**: 
  - 自动防止意外缩放
  - 键盘弹起时输入框自动滚动到可视区域
  - 表格输入支持键盘导航
- **深色模式**: 支持系统自动切换或手动切换，复选框可见性已优化

### 管理员功能

- **用户管理**: 添加、编辑、删除用户账户
- **权限控制**: 为用户分配模块访问权限
- **状态管理**: 启用/禁用用户账户
- **密码重置**: 为用户重置密码

## 已知问题和限制

### 当前限制
1. **localStorage容量限制**: 浏览器通常限制在5-10MB，建议定期导出数据
2. **离线功能**: 目前不支持完全离线使用，需要网络连接进行认证
3. **AI功能**: 需要有效的API密钥，调用有频率限制
4. **批量导入**: 暂不支持Excel等格式的批量数据导入

### 性能优化建议
- 建议定期清理历史记录中的过期数据
- 大量数据时使用搜索和过滤功能提高查询效率
- 移动端使用时建议关闭不必要的浏览器标签页

## 更新日志

### V1.3.3 - 安卓设备PDF预览体验重大优化 (2025-01-07)
- **📱 统一安卓设备处理逻辑**: 为安卓设备提供专门优化的PDF查看体验
  - 智能检测安卓设备和浏览器类型（Chrome、Firefox、Safari、Edge等）
  - 安卓Chrome浏览器推荐"新窗口打开"，其他浏览器推荐"下载"
  - 统一所有PDF预览组件的安卓设备处理逻辑，消除不一致的用户体验
- **🎯 优化用户提示信息**: 提供清晰的操作指导和浏览器建议
  - 显示设备类型和浏览器信息标识，让用户了解当前环境
  - 提供针对性的使用建议和最佳实践指导
  - 弹窗阻止检测和友好的错误提示
  - 分别为Chrome和其他浏览器提供不同的优化建议
- **✨ 改进预览界面体验**: 更好的视觉反馈和操作选项
  - 推荐操作按钮突出显示（"新窗口打开(推荐)"、"下载(推荐)"）
  - 安卓设备专用的优化建议提示卡片
  - 更清晰的操作流程和选项说明
  - 非Chrome浏览器用户友好的浏览器推荐提示
- **🔧 技术优化**: 
  - 重构`pdfHelpers.ts`，添加`getBrowserInfo()`和智能推荐逻辑
  - 优化`PDFPreviewComponent`和`PDFPreviewModal`的设备检测
  - 新增`forceAndroidFallback`选项确保安卓设备体验一致性
  - 在新窗口打开PDF时针对安卓设备进行特殊处理

### V1.3.2 - 深色模式和编译问题修复 (2025-01-04)
- **🐛 编译错误修复**: 修复PDFPreviewComponent.tsx语法错误，确保项目正常构建
- **🐛 iOS光标类型错误修复**: 解决WebKit属性在TypeScript中的类型冲突问题
- **🐛 jsPDF接口类型修复**: 修复ExtendedJsPDF接口与基类方法签名不兼容问题
- **🎨 深色模式复选框优化**: 全面修复单据管理中心深色模式下复选框可见性问题
  - 增强边框对比度：改进`dark:border-gray-400`提供更好可见性
  - 添加背景色：`bg-white dark:bg-gray-800`确保合适的背景
  - 主题色选中状态：每个页面使用对应主题色的醒目复选框
  - 报价单：蓝色系 | 发票：紫色系 | 采购单：橙色系 | 装箱单：青色系 | 确认单：绿色系
- **📱 移动端兼容性**: 确保所有修复在移动端深色模式下正常工作
- **✅ 构建成功**: 项目现在可以正常构建，退出代码0，仅剩ESLint警告

### V1.3.1 - 移动端输入体验全面优化 (2025-01-03)
- **iOS光标可见性问题修复**: 系统性解决了iOS设备上输入框光标"隐藏在图层下方"的问题
- **统一优化策略**: 开发了统一的`ios-optimized-input`CSS类，应用于所有输入框组件
- **全页面覆盖**: 优化覆盖所有页面的输入框，包括报价单、发票、采购单、装箱单页面
- **移动端文字大小优化**: 防止iOS设备自动放大，智能字体大小适配
- **键盘弹起滚动优化**: 智能滚动定位，300ms延迟处理，平滑滚动体验
- **触摸体验优化**: 触摸动作优化，长按菜单控制，文本选择优化
- **视口和PWA优化**: 专业视口设置，PWA支持，状态栏适配
- **表格输入框移动端适配**: 最小高度保证，行高优化，硬件加速
- **兼容性保证**: 渐进式增强策略，不影响其他平台正常使用

### V1.3.0 - 装箱单功能完整实现 (2025-01-02)
- **装箱单页面功能**: 完整实现装箱单和形式发票生成功能
- **智能配置系统**: 根据文档类型自动调整显示选项
- **收货人信息管理**: 支持详细的收货人信息录入和管理
- **灵活显示选项**: 可配置显示HS编码、尺寸、重量包装、价格等
- **唛头信息支持**: 专门的唛头编辑模态框
- **智能单位系统**: 支持多种单位，自动处理单复数转换
- **完整历史记录**: 创建装箱单历史记录管理工具函数
- **历史页面集成**: 在单据管理中心添加装箱单tab
- **编辑复制功能**: 实现装箱单的编辑和复制功能

### V1.2.1 - 搜索结果显示优化 (2024-12-30)
- **智能搜索徽章**: 每个tab图标显示红色徽章，实时显示搜索结果数量
- **过滤条件响应**: 所有过滤条件都会触发徽章显示
- **实时更新**: 徽章数量随搜索和过滤条件实时更新
- **视觉区分**: 有过滤条件时显示红色徽章，无过滤条件时显示默认色徽章

### V1.2.0 - 历史管理功能完善 (2024-12-28)
- **统一历史页面布局**: 所有历史页面采用统一的现代化布局
- **增强排序功能**: 表头排序功能，支持多字段排序
- **完善操作功能**: 预览、编辑、复制、删除等完整操作
- **批量操作支持**: 支持批量选择和批量删除
- **高级过滤功能**: 日期范围和金额范围过滤
- **智能搜索**: 多字段搜索功能
- **金额统计**: 按币种分类的金额统计显示
- **视觉优化**: 不同类型历史记录使用不同主题色彩

## 开发路线图

### 短期计划 (1-2个月)
- [ ] **Excel导入导出**: 支持Excel格式的数据导入导出
- [ ] **模板系统**: 可保存和复用的文档模板
- [ ] **签名功能**: PDF文档数字签名支持
- [ ] **更多AI功能**: 智能数据填充、单据自动分类

### 中期计划 (3-6个月)
- [ ] **客户管理系统**: 完整的CRM功能
- [ ] **库存管理**: 产品库存跟踪和管理
- [ ] **数据分析**: 销售数据分析和报表
- [ ] **多语言支持**: 国际化多语言界面

### 长期计划 (6个月+)
- [ ] **移动APP**: React Native移动应用
- [ ] **协作功能**: 多用户协作编辑
- [ ] **API接口**: 开放API供第三方集成
- [ ] **云同步**: 多设备数据同步功能

## 贡献指南

### 开发流程
1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/新功能`)
3. 提交更改 (`git commit -am '添加新功能'`)
4. 推送到分支 (`git push origin feature/新功能`)
5. 创建 Pull Request

### 代码规范
- 使用 TypeScript 进行类型安全开发
- 遵循 ESLint 规则
- 组件命名使用 PascalCase
- 文件命名使用 kebab-case
- 提交信息使用中文，格式：`类型: 描述`

### 问题报告
- 使用 GitHub Issues 报告问题
- 提供详细的重现步骤
- 包含浏览器和设备信息
- 如有可能，提供截图或录屏

## 联系方式

- **邮箱**: luo@luocompany.com
- **设计**: Roger
- **版本**: 2025

## 许可证

[MIT License](LICENSE)

---

**注意**: 这是一个持续开发的项目，功能和文档会定期更新。建议定期查看更新日志了解最新功能和修复。
